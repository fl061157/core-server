package cn.v5.service;

import cn.v5.code.StatusCode;
import cn.v5.entity.vo.ThirdAppRecommendUser;
import cn.v5.web.controller.ServerException;
import com.fasterxml.jackson.databind.*;
import com.fasterxml.jackson.databind.introspect.JacksonAnnotationIntrospector;
import com.fasterxml.jackson.databind.node.ArrayNode;
import junit.framework.Assert;
import org.apache.commons.lang3.StringUtils;
import org.junit.Before;
import org.junit.Test;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class FriendRecommendServiceTest {
    private ObjectMapper objectMapper;

    @Before
    public void before() {
        this.objectMapper = new ObjectMapper();
//        this.objectMapper.setSerializationInclusion(JsonSerialize.Inclusion.NON_NULL);
        this.objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        this.objectMapper.setPropertyNamingStrategy(PropertyNamingStrategy.CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES);

        //this.objectMapper.configure(SerializationConfig.Feature.INDENT_OUTPUT, true);
        this.objectMapper.configure(SerializationFeature.WRITE_NULL_MAP_VALUES, false);

        this.objectMapper.setAnnotationIntrospector(new JacksonAnnotationIntrospector());
    }


    @Test
    public void testGetRecommendFromWeibo() throws Exception {
        final List<String> result = new ArrayList<>();
//        String weiboResult = "{\"ids\":[1726475555,1404376560,1233616152],\"total_number\":668}";
        String weiboResult = "{\"request\" : \"/statuses/home_timeline.json\",\"error_code\" : \"21327\",\"error\" : \"Expired token.\"}";
        if (StringUtils.isNoneBlank(weiboResult)) {
            try {
                JsonNode weiboJson = objectMapper.readTree(weiboResult);
                JsonNode errorCodeNode = weiboJson.get("error_code");
                if (null != errorCodeNode) {

                    String errorCode = errorCodeNode.asText();
                    //http://open.weibo.com/wiki/Error_code
                    if ("21314".equalsIgnoreCase(errorCode) || "21315".equalsIgnoreCase(errorCode) || "21316".equalsIgnoreCase(errorCode) || "21317".equalsIgnoreCase(errorCode) || "21327".equalsIgnoreCase(errorCode)) {
                        throw new ServerException(StatusCode.INVALID_TOKEN, "invalid access token");
                    }
                } else {
                    ArrayNode arrayNode = (ArrayNode) weiboJson.get("ids");
                    if (null != arrayNode && arrayNode.size() > 0) {
                        arrayNode.elements().forEachRemaining(jsonNode -> result.add(jsonNode.asText()));
                    }
                }
            } catch (IOException e) {

            }
        }


        Assert.assertTrue(result.size() == 3);
        System.out.println(Arrays.toString(result.toArray()));

    }

    @Test
    public void testParseWeiboResult() throws IOException {
        String weiboResult = "{\"users\":[{\"id\":1563949653,\"idstr\":\"1563949653\",\"class\":1,\"screen_name\":\"李联臣\",\"name\":\"李联臣\",\"province\":\"31\",\"city\":\"4\",\"location\":\"上海 徐汇区\",\"description\":\"产品 技术 设计 一样都少不了\",\"url\":\"http://blog.sina.com.cn/cheneyllc\",\"profile_image_url\":\"http://tp2.sinaimg.cn/1563949653/50/5627291132/1\",\"profile_url\":\"lianchenli\",\"domain\":\"lianchenli\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":124,\"friends_count\":146,\"pagefriends_count\":1,\"statuses_count\":417,\"favourites_count\":4,\"created_at\":\"Mon Mar 07 14:15:59 +0800 2011\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Sat Jul 11 17:12:42 +0800 2015\",\"id\":3863467788744789,\"mid\":\"3863467788744789\",\"idstr\":\"3863467788744789\",\"text\":\"我参与了@微博新鲜事 发起的投票 【#贾玲恶搞花>木兰#贾玲小品中恶搞花木兰，你怎么看？】，我投给了“必须道歉”这个选项。你也快来表态吧~\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/3PAXPy\\\" rel=\\\"nofollow\\\">投票</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"annotations\":[{\"source\":{\"name\":\"微博投票\",\"appid\":\"2378809800\",\"url\":\"http://vote.weibo.com\"}}],\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/1563949653/180/5627291132/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/1563949653/180/5627291132/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":60,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"urank\":21},{\"id\":1212263877,\"idstr\":\"1212263877\",\"class\":1,\"screen_name\":\"ZHONG子航\",\"name\":\"ZHONG子航\",\"province\":\"44\",\"city\":\"1\",\"location\":\"广东 广州\",\"description\":\"\",\"url\":\"\",\"profile_image_url\":\"http://tp2.sinaimg.cn/1212263877/50/5624540072/1\",\"cover_image_phone\":\"http://ww1.sinaimg.cn/crop.0.0.640.640/7c85468fjw1e8yqchu1r6j20hs0hs40q.jpg\",\"profile_url\":\"u/1212263877\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":222,\"friends_count\":7,\"pagefriends_count\":0,\"statuses_count\":1,\"favourites_count\":644,\"created_at\":\"Mon Feb 08 20:11:16 +0800 2010\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Fri Jul 10 19:32:02 +0800 2015\",\"id\":3863140465301314,\"mid\":\"3863140465301314\",\"idstr\":\"3863140465301314\",\"text\":\"写的真不错——评论南峰子的技术博客「Swift闭包一：闭包基础概念」http://t.cn/RPJeHAB\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/4XtHni\\\" rel=\\\"nofollow\\\">多说评论框</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/1212263877/180/5624540072/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/1212263877/180/5624540072/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":3,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"urank\":0},{\"id\":3402075510,\"idstr\":\"3402075510\",\"class\":1,\"screen_name\":\"创艺3D打印体验中心方利\",\"name\":\"创艺3D打印体验中心方利\",\"province\":\"32\",\"city\":\"1\",\"location\":\"江苏 南京\",\"description\":\"我就是我，名副其实的行动派。\",\"url\":\"\",\"profile_image_url\":\"http://tp3.sinaimg.cn/3402075510/50/5671965016/0\",\"cover_image_phone\":\"http://ww2.sinaimg.cn/crop.0.0.640.640.640/a1d3feabjw1ecasunmkncj20hs0hsq4j.jpg\",\"profile_url\":\"u/3402075510\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"f\",\"followers_count\":448,\"friends_count\":1193,\"pagefriends_count\":0,\"statuses_count\":48,\"favourites_count\":0,\"created_at\":\"Thu May 02 17:30:03 +0800 2013\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Thu Apr 10 22:38:02 +0800 2014\",\"id\":3697938402822408,\"mid\":\"3697938402822408\",\"idstr\":\"3697938402822408\",\"text\":\"寻狗狗-（博美犬）家属启示，今天4月10日发现在我家楼下，地址：南京市秦淮区中和桥路59-1双杰浴室附近，刚刚修过毛发，请狗狗主人来认领。麻烦小伙伴们互相转发，狗狗早日回归家庭。\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/9ksdit\\\" rel=\\\"nofollow\\\">iPhone客户端</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[{\"thumbnail_pic\":\"http://ww1.sinaimg.cn/thumbnail/cac78d76jw1efavghneqsj20xc18gdt6.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgl10fij20xc18g7hr.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgmsfvqj20xc18gwrz.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgoqkqej20xc18ggz0.jpg\"},{\"thumbnail_pic\":\"http://ww4.sinaimg.cn/thumbnail/cac78d76jw1efavgq2nzbj20xc18g4bx.jpg\"},{\"thumbnail_pic\":\"http://ww4.sinaimg.cn/thumbnail/cac78d76jw1efavgs6ktqj20xc18gqfy.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgtmaoxj20xc18gnax.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgvavzrj20xc18gnb4.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgx8fggj20xc18gws9.jpg\"}],\"thumbnail_pic\":\"http://ww1.sinaimg.cn/thumbnail/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"bmiddle_pic\":\"http://ww1.sinaimg.cn/bmiddle/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"original_pic\":\"http://ww1.sinaimg.cn/large/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"geo\":null,\"annotations\":[{\"client_mblogid\":\"iPhone-F834113B-B5DE-4BB5-987A-22F0E277AF4E\"}],\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp3.sinaimg.cn/3402075510/180/5671965016/0\",\"avatar_hd\":\"http://ww1.sinaimg.cn/crop.0.0.180.180.1024/cac78d76jw8e7tcf5psd3j2050050a9z.jpg\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":306,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":5},{\"id\":2010866837,\"idstr\":\"2010866837\",\"class\":1,\"screen_name\":\"wolfbro\",\"name\":\"wolfbro\",\"province\":\"32\",\"city\":\"1000\",\"location\":\"江苏\",\"description\":\"\",\"url\":\"\",\"profile_image_url\":\"http://tp2.sinaimg.cn/2010866837/50/5667784250/1\",\"profile_url\":\"u/2010866837\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":172,\"friends_count\":195,\"pagefriends_count\":0,\"statuses_count\":1026,\"favourites_count\":4,\"created_at\":\"Mon Mar 07 11:06:15 +0800 2011\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":false,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Tue May 12 12:24:58 +0800 2015\",\"id\":3841652102171715,\"mid\":\"3841652102171715\",\"idstr\":\"3841652102171715\",\"text\":\"@道哥有道 @BboyDean @洲西满飞鸿 小百合站庆抽奖，抽抽抽\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://weibo.com/\\\" rel=\\\"nofollow\\\">微博 weibo.com</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/2010866837/180/5667784250/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/2010866837/180/5667784250/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":23,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":15},{\"id\":2623590665,\"idstr\":\"2623590665\",\"class\":1,\"screen_name\":\"书信微博\",\"name\":\"书信微博\",\"province\":\"31\",\"city\":\"4\",\"location\":\"上海 徐汇区\",\"description\":\"通过手写笔迹或键盘，创建具有个人风格的图文微博，还可自动投递实体信哦～即刻免费体验吧：http://hjtimes.com/go\",\"url\":\"http://hjtimes.com\",\"profile_image_url\":\"http://tp2.sinaimg.cn/2623590665/50/5632817807/1\",\"profile_url\":\"u/2623590665\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":2369,\"friends_count\":837,\"pagefriends_count\":0,\"statuses_count\":751,\"favourites_count\":57,\"created_at\":\"Sun Feb 19 20:20:15 +0800 2012\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Thu May 01 22:51:20 +0800 2014\",\"id\":3705551894694731,\"mid\":\"3705551894694731\",\"idstr\":\"3705551894694731\",\"text\":\"最危险的职业之一，应该得到最好的保障和待遇。\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/9ksdit\\\" rel=\\\"nofollow\\\">iPhone客户端</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/2623590665/180/5632817807/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/2623590665/180/5632817807/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":338,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":12}],\"total_number\":14}";
        final List<ThirdAppRecommendUser> result = new ArrayList<>();

        JsonNode weiboJson = objectMapper.readTree(weiboResult);
        ArrayNode arrayNode = (ArrayNode) weiboJson.get("users");
        if (null != arrayNode && arrayNode.size() > 0) {
            arrayNode.elements().forEachRemaining(jsonNode -> {
                String screenName = jsonNode.get("screen_name").asText();
                String name = jsonNode.get("name").asText();
                String id = jsonNode.get("id").asText();
                ThirdAppRecommendUser user = new ThirdAppRecommendUser();
                user.setAppUserId(id);
                user.setAppUserName(org.apache.commons.lang.StringUtils.isBlank(screenName) ? name : screenName);
                result.add(user);
            });
        }


        Assert.assertNotNull(result);
    }


    @Test
    public void testParseFaceBookResult() throws IOException {
        String weiboResult = "{\"users\":[{\"id\":1563949653,\"idstr\":\"1563949653\",\"class\":1,\"screen_name\":\"李联臣\",\"name\":\"李联臣\",\"province\":\"31\",\"city\":\"4\",\"location\":\"上海 徐汇区\",\"description\":\"产品 技术 设计 一样都少不了\",\"url\":\"http://blog.sina.com.cn/cheneyllc\",\"profile_image_url\":\"http://tp2.sinaimg.cn/1563949653/50/5627291132/1\",\"profile_url\":\"lianchenli\",\"domain\":\"lianchenli\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":124,\"friends_count\":146,\"pagefriends_count\":1,\"statuses_count\":417,\"favourites_count\":4,\"created_at\":\"Mon Mar 07 14:15:59 +0800 2011\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Sat Jul 11 17:12:42 +0800 2015\",\"id\":3863467788744789,\"mid\":\"3863467788744789\",\"idstr\":\"3863467788744789\",\"text\":\"我参与了@微博新鲜事 发起的投票 【#贾玲恶搞花>木兰#贾玲小品中恶搞花木兰，你怎么看？】，我投给了“必须道歉”这个选项。你也快来表态吧~\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/3PAXPy\\\" rel=\\\"nofollow\\\">投票</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"annotations\":[{\"source\":{\"name\":\"微博投票\",\"appid\":\"2378809800\",\"url\":\"http://vote.weibo.com\"}}],\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/1563949653/180/5627291132/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/1563949653/180/5627291132/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":60,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"urank\":21},{\"id\":1212263877,\"idstr\":\"1212263877\",\"class\":1,\"screen_name\":\"ZHONG子航\",\"name\":\"ZHONG子航\",\"province\":\"44\",\"city\":\"1\",\"location\":\"广东 广州\",\"description\":\"\",\"url\":\"\",\"profile_image_url\":\"http://tp2.sinaimg.cn/1212263877/50/5624540072/1\",\"cover_image_phone\":\"http://ww1.sinaimg.cn/crop.0.0.640.640/7c85468fjw1e8yqchu1r6j20hs0hs40q.jpg\",\"profile_url\":\"u/1212263877\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":222,\"friends_count\":7,\"pagefriends_count\":0,\"statuses_count\":1,\"favourites_count\":644,\"created_at\":\"Mon Feb 08 20:11:16 +0800 2010\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Fri Jul 10 19:32:02 +0800 2015\",\"id\":3863140465301314,\"mid\":\"3863140465301314\",\"idstr\":\"3863140465301314\",\"text\":\"写的真不错——评论南峰子的技术博客「Swift闭包一：闭包基础概念」http://t.cn/RPJeHAB\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/4XtHni\\\" rel=\\\"nofollow\\\">多说评论框</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/1212263877/180/5624540072/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/1212263877/180/5624540072/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":3,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"urank\":0},{\"id\":3402075510,\"idstr\":\"3402075510\",\"class\":1,\"screen_name\":\"创艺3D打印体验中心方利\",\"name\":\"创艺3D打印体验中心方利\",\"province\":\"32\",\"city\":\"1\",\"location\":\"江苏 南京\",\"description\":\"我就是我，名副其实的行动派。\",\"url\":\"\",\"profile_image_url\":\"http://tp3.sinaimg.cn/3402075510/50/5671965016/0\",\"cover_image_phone\":\"http://ww2.sinaimg.cn/crop.0.0.640.640.640/a1d3feabjw1ecasunmkncj20hs0hsq4j.jpg\",\"profile_url\":\"u/3402075510\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"f\",\"followers_count\":448,\"friends_count\":1193,\"pagefriends_count\":0,\"statuses_count\":48,\"favourites_count\":0,\"created_at\":\"Thu May 02 17:30:03 +0800 2013\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Thu Apr 10 22:38:02 +0800 2014\",\"id\":3697938402822408,\"mid\":\"3697938402822408\",\"idstr\":\"3697938402822408\",\"text\":\"寻狗狗-（博美犬）家属启示，今天4月10日发现在我家楼下，地址：南京市秦淮区中和桥路59-1双杰浴室附近，刚刚修过毛发，请狗狗主人来认领。麻烦小伙伴们互相转发，狗狗早日回归家庭。\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/9ksdit\\\" rel=\\\"nofollow\\\">iPhone客户端</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[{\"thumbnail_pic\":\"http://ww1.sinaimg.cn/thumbnail/cac78d76jw1efavghneqsj20xc18gdt6.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgl10fij20xc18g7hr.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgmsfvqj20xc18gwrz.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgoqkqej20xc18ggz0.jpg\"},{\"thumbnail_pic\":\"http://ww4.sinaimg.cn/thumbnail/cac78d76jw1efavgq2nzbj20xc18g4bx.jpg\"},{\"thumbnail_pic\":\"http://ww4.sinaimg.cn/thumbnail/cac78d76jw1efavgs6ktqj20xc18gqfy.jpg\"},{\"thumbnail_pic\":\"http://ww2.sinaimg.cn/thumbnail/cac78d76jw1efavgtmaoxj20xc18gnax.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgvavzrj20xc18gnb4.jpg\"},{\"thumbnail_pic\":\"http://ww3.sinaimg.cn/thumbnail/cac78d76jw1efavgx8fggj20xc18gws9.jpg\"}],\"thumbnail_pic\":\"http://ww1.sinaimg.cn/thumbnail/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"bmiddle_pic\":\"http://ww1.sinaimg.cn/bmiddle/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"original_pic\":\"http://ww1.sinaimg.cn/large/cac78d76jw1efavghneqsj20xc18gdt6.jpg\",\"geo\":null,\"annotations\":[{\"client_mblogid\":\"iPhone-F834113B-B5DE-4BB5-987A-22F0E277AF4E\"}],\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp3.sinaimg.cn/3402075510/180/5671965016/0\",\"avatar_hd\":\"http://ww1.sinaimg.cn/crop.0.0.180.180.1024/cac78d76jw8e7tcf5psd3j2050050a9z.jpg\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":306,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":5},{\"id\":2010866837,\"idstr\":\"2010866837\",\"class\":1,\"screen_name\":\"wolfbro\",\"name\":\"wolfbro\",\"province\":\"32\",\"city\":\"1000\",\"location\":\"江苏\",\"description\":\"\",\"url\":\"\",\"profile_image_url\":\"http://tp2.sinaimg.cn/2010866837/50/5667784250/1\",\"profile_url\":\"u/2010866837\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":172,\"friends_count\":195,\"pagefriends_count\":0,\"statuses_count\":1026,\"favourites_count\":4,\"created_at\":\"Mon Mar 07 11:06:15 +0800 2011\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":false,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Tue May 12 12:24:58 +0800 2015\",\"id\":3841652102171715,\"mid\":\"3841652102171715\",\"idstr\":\"3841652102171715\",\"text\":\"@道哥有道 @BboyDean @洲西满飞鸿 小百合站庆抽奖，抽抽抽\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://weibo.com/\\\" rel=\\\"nofollow\\\">微博 weibo.com</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/2010866837/180/5667784250/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/2010866837/180/5667784250/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":23,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":15},{\"id\":2623590665,\"idstr\":\"2623590665\",\"class\":1,\"screen_name\":\"书信微博\",\"name\":\"书信微博\",\"province\":\"31\",\"city\":\"4\",\"location\":\"上海 徐汇区\",\"description\":\"通过手写笔迹或键盘，创建具有个人风格的图文微博，还可自动投递实体信哦～即刻免费体验吧：http://hjtimes.com/go\",\"url\":\"http://hjtimes.com\",\"profile_image_url\":\"http://tp2.sinaimg.cn/2623590665/50/5632817807/1\",\"profile_url\":\"u/2623590665\",\"domain\":\"\",\"weihao\":\"\",\"gender\":\"m\",\"followers_count\":2369,\"friends_count\":837,\"pagefriends_count\":0,\"statuses_count\":751,\"favourites_count\":57,\"created_at\":\"Sun Feb 19 20:20:15 +0800 2012\",\"following\":true,\"allow_all_act_msg\":false,\"geo_enabled\":true,\"verified\":false,\"verified_type\":-1,\"remark\":\"\",\"status\":{\"created_at\":\"Thu May 01 22:51:20 +0800 2014\",\"id\":3705551894694731,\"mid\":\"3705551894694731\",\"idstr\":\"3705551894694731\",\"text\":\"最危险的职业之一，应该得到最好的保障和待遇。\",\"source_allowclick\":0,\"source_type\":1,\"source\":\"<a href=\\\"http://app.weibo.com/t/feed/9ksdit\\\" rel=\\\"nofollow\\\">iPhone客户端</a>\",\"favorited\":false,\"truncated\":false,\"in_reply_to_status_id\":\"\",\"in_reply_to_user_id\":\"\",\"in_reply_to_screen_name\":\"\",\"pic_urls\":[],\"geo\":null,\"reposts_count\":0,\"comments_count\":0,\"attitudes_count\":0,\"mlevel\":0,\"visible\":{\"type\":0,\"list_id\":0},\"darwin_tags\":[]},\"ptype\":0,\"allow_all_comment\":true,\"avatar_large\":\"http://tp2.sinaimg.cn/2623590665/180/5632817807/1\",\"avatar_hd\":\"http://tp2.sinaimg.cn/2623590665/180/5632817807/1\",\"verified_reason\":\"\",\"verified_trade\":\"\",\"verified_reason_url\":\"\",\"verified_source\":\"\",\"verified_source_url\":\"\",\"follow_me\":true,\"online_status\":0,\"bi_followers_count\":338,\"lang\":\"zh-cn\",\"star\":0,\"mbtype\":0,\"mbrank\":0,\"block_word\":0,\"block_app\":0,\"credit_score\":80,\"user_ability\":0,\"urank\":12}],\"total_number\":14}";
        final List<ThirdAppRecommendUser> result = new ArrayList<>();

        JsonNode weiboJson = objectMapper.readTree(weiboResult);
        ArrayNode arrayNode = (ArrayNode) weiboJson.get("users");
        if (null != arrayNode && arrayNode.size() > 0) {
            arrayNode.elements().forEachRemaining(jsonNode -> {
                String screenName = jsonNode.get("screen_name").asText();
                String name = jsonNode.get("name").asText();
                String id = jsonNode.get("id").asText();
                ThirdAppRecommendUser user = new ThirdAppRecommendUser();
                user.setAppUserId(id);
                user.setAppUserName(org.apache.commons.lang.StringUtils.isBlank(screenName) ? name : screenName);
                result.add(user);
            });
        }


        Assert.assertNotNull(result);
    }
}